/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/js-sdk-utils"),r=require("@convertcom/js-sdk-enums");function o(e){var r="function"==typeof Symbol&&Symbol.iterator,o=r&&e[r],t=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}"function"==typeof SuppressedError&&SuppressedError;var t=function(){function t(r,o){var t=(void 0===o?{}:o).loggerManager;this._comparisonProcessor=e.Comparisons,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=t,this._comparisonProcessor=e.objectDeepValue(r,"rules.comparisonProcessor",e.Comparisons),this._negation=String(e.objectDeepValue(r,"rules.negation","!")).valueOf(),this._keys_case_sensitive=e.objectDeepValue(r,"rules.keys_case_sensitive",true,!0)}return Object.defineProperty(t.prototype,"comparisonProcessor",{get:function(){return this._comparisonProcessor},set:function(e){this._comparisonProcessor=e},enumerable:!1,configurable:!0}),t.prototype.getComparisonProcessorMethods=function(){var e=this;return Object.getOwnPropertyNames(this._comparisonProcessor).filter((function(r){return"function"==typeof e._comparisonProcessor[r]}))},t.prototype.isRuleMatched=function(o,t,n,l){var i,a,s,c,u,p,_,v,g,d,y;if(void 0===l&&(l="id"),n&&((null==o?void 0:o[l])?null===(a=null===(i=this._loggerManager)||void 0===i?void 0:i.info)||void 0===a||a.call(i,r.MESSAGES.PROCESSING_ENTITY.replace("#","".concat(e.camelCase(n)," #").concat(null==o?void 0:o[l]))):null===(c=null===(s=this._loggerManager)||void 0===s?void 0:s.info)||void 0===c||c.call(s,r.MESSAGES.PROCESSING_ENTITY.replace("#",e.camelCase(n)))),Object.prototype.hasOwnProperty.call(t,"OR")&&e.arrayNotEmpty(null==t?void 0:t.OR)){for(var h=0,f=t.OR.length;h<f;h++)if(y=this._processAND(o,t.OR[h]),Object.values(r.RuleError).includes(y)?null===(p=null===(u=this._loggerManager)||void 0===u?void 0:u.info)||void 0===p||p.call(u,r.ERROR_MESSAGES.RULE_ERROR):null===(v=null===(_=this._loggerManager)||void 0===_?void 0:_.info)||void 0===v||v.call(_,!1===y?r.MESSAGES.RULE_NOT_MATCH:r.MESSAGES.RULE_MATCH.replace("#",String(h))),!1!==y)return y}else null===(d=null===(g=this._loggerManager)||void 0===g?void 0:g.warn)||void 0===d||d.call(g,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},t.prototype.isValidRule=function(e){return Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")},t.prototype._processAND=function(o,t){var n,l,i,a,s;if(Object.prototype.hasOwnProperty.call(t,"AND")&&e.arrayNotEmpty(null==t?void 0:t.AND)){for(var c=0,u=t.AND.length;c<u;c++)if(!1===(s=this._processORWHEN(o,t.AND[c])))return!1;return!1!==s&&(null===(l=null===(n=this._loggerManager)||void 0===n?void 0:n.info)||void 0===l||l.call(n,r.MESSAGES.RULE_MATCH_AND)),s}return null===(a=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===a||a.call(i,r.ERROR_MESSAGES.RULE_NOT_VALID),!1},t.prototype._processORWHEN=function(o,t){var n,l,i;if(Object.prototype.hasOwnProperty.call(t,"OR_WHEN")&&e.arrayNotEmpty(null==t?void 0:t.OR_WHEN)){for(var a=0,s=t.OR_WHEN.length;a<s;a++)if(!1!==(i=this._processRuleItem(o,t.OR_WHEN[a])))return i}else null===(l=null===(n=this._loggerManager)||void 0===n?void 0:n.warn)||void 0===l||l.call(n,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},t.prototype._processRuleItem=function(t,n){var l,i,a,s,c,u,p,_,v,g,d,y;if(this.isValidRule(n))try{var h=n.matching.negated||!1,f=n.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(f))if("object"==typeof t){if(t.constructor===Object)try{for(var E=o(Object.keys(t)),R=E.next();!R.done;R=E.next()){var O=R.value;if((this._keys_case_sensitive?O:O.toLowerCase())===(this._keys_case_sensitive?n.key:n.key.toLowerCase()))return this._comparisonProcessor[f](t[O],n.value,h)}}catch(e){l={error:e}}finally{try{R&&!R.done&&(i=E.return)&&i.call(E)}finally{if(l)throw l.error}}else if(null==n?void 0:n.rule_type){null===(u=null===(c=this._loggerManager)||void 0===c?void 0:c.info)||void 0===u||u.call(c,r.MESSAGES.RULE_MATCH_START.replace("#",n.rule_type));try{for(var S=o(Object.getOwnPropertyNames(t.constructor.prototype)),m=S.next();!m.done;m=S.next()){var M=m.value;if("constructor"!==M)if(M===e.camelCase("get ".concat(n.rule_type.replace(/_/g," ")))){var A=t[M](n);return Object.values(r.RuleError).includes(A)||"js_condition"===n.rule_type?A:this._comparisonProcessor[f](A,n.value,h)}}}catch(e){a={error:e}}finally{try{m&&!m.done&&(s=S.return)&&s.call(S)}finally{if(a)throw a.error}}}}else null===(_=null===(p=this._loggerManager)||void 0===p?void 0:p.warn)||void 0===_||_.call(p,"RuleManager._processRule()",{warn:r.ERROR_MESSAGES.RULE_DATA_NOT_VALID})}catch(e){null===(g=null===(v=this._loggerManager)||void 0===v?void 0:v.error)||void 0===g||g.call(v,"RuleManager._processRule()",{error:e.message})}else null===(y=null===(d=this._loggerManager)||void 0===d?void 0:d.warn)||void 0===y||y.call(d,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},t}();exports.RuleManager=t;
//# sourceMappingURL=index.min.js.map
