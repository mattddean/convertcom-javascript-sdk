/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/js-sdk-utils"),r=require("@convertcom/js-sdk-enums");function t(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}"function"==typeof SuppressedError&&SuppressedError;var o=function(){function o(r,t){var o=(void 0===t?{}:t).loggerManager;this._comparisonProcessor=e.Comparisons,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=o,this._comparisonProcessor=e.objectDeepValue(r,"rules.comparisonProcessor",e.Comparisons),this._negation=String(e.objectDeepValue(r,"rules.negation","!")).valueOf(),this._keys_case_sensitive=e.objectDeepValue(r,"rules.keys_case_sensitive",true,!0)}return Object.defineProperty(o.prototype,"comparisonProcessor",{get:function(){return this._comparisonProcessor},set:function(e){this._comparisonProcessor=e},enumerable:!1,configurable:!0}),o.prototype.getComparisonProcessorMethods=function(){var e=this;return Object.getOwnPropertyNames(this._comparisonProcessor).filter((function(r){return"function"==typeof e._comparisonProcessor[r]}))},o.prototype.isRuleMatched=function(r,t){var o;if(Object.prototype.hasOwnProperty.call(t,"OR")&&e.arrayNotEmpty(null==t?void 0:t.OR))for(var n=0,s=t.OR.length;n<s;n++)if(!1!==(o=this._processAND(r,t.OR[n])))return o;return!1},o.prototype.isValidRule=function(e){return Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")},o.prototype._processAND=function(r,t){var o;if(Object.prototype.hasOwnProperty.call(t,"AND")&&e.arrayNotEmpty(null==t?void 0:t.AND)){for(var n=0,s=t.AND.length;n<s;n++)if(!1===(o=this._processORWHEN(r,t.AND[n])))return!1;return o}return!1},o.prototype._processORWHEN=function(r,t){var o;if(Object.prototype.hasOwnProperty.call(t,"OR_WHEN")&&e.arrayNotEmpty(null==t?void 0:t.OR_WHEN))for(var n=0,s=t.OR_WHEN.length;n<s;n++)if(!1!==(o=this._processRuleItem(r,t.OR_WHEN[n])))return o;return!1},o.prototype._processRuleItem=function(o,n){var s,i,a,c;if(this.isValidRule(n))try{var p=n.matching.negated||!1,l=n.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(l)&&"object"==typeof o)if(o.constructor===Object)try{for(var u=t(Object.keys(o)),y=u.next();!y.done;y=u.next()){var f=y.value;if((this._keys_case_sensitive?f:f.toLowerCase())===(this._keys_case_sensitive?n.key:n.key.toLowerCase()))return this._comparisonProcessor[l](o[f],n.value,p)}}catch(e){s={error:e}}finally{try{y&&!y.done&&(i=u.return)&&i.call(u)}finally{if(s)throw s.error}}else if(null==n?void 0:n.rule_type)try{for(var h=t(Object.getOwnPropertyNames(o.constructor.prototype)),_=h.next();!_.done;_=h.next()){var m=_.value;if("constructor"!==m)if(m===e.camelCase("get ".concat(n.rule_type.replace(/_/g," ")))){var v=o[m](n);return Object.values(r.RuleError).includes(v)||"js_condition"===n.rule_type?v:this._comparisonProcessor[l](v,n.value,p)}}}catch(e){a={error:e}}finally{try{_&&!_.done&&(c=h.return)&&c.call(h)}finally{if(a)throw a.error}}}catch(e){}return!1},o}();exports.RuleManager=o;
//# sourceMappingURL=index.min.js.map
