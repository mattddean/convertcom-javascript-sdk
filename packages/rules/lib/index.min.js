/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/js-sdk-utils"),o=require("@convertcom/js-sdk-enums");exports.RuleManager=class{constructor(o,{loggerManager:r}={}){this._comparisonProcessor=e.Comparisons,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=r,this._comparisonProcessor=e.objectDeepValue(o,"rules.comparisonProcessor",e.Comparisons),this._negation=String(e.objectDeepValue(o,"rules.negation","!")).valueOf(),this._keys_case_sensitive=e.objectDeepValue(o,"rules.keys_case_sensitive",true,!0)}set comparisonProcessor(e){this._comparisonProcessor=e}get comparisonProcessor(){return this._comparisonProcessor}getComparisonProcessorMethods(){return Object.getOwnPropertyNames(this._comparisonProcessor).filter((e=>"function"==typeof this._comparisonProcessor[e]))}isRuleMatched(r,t,s){var l,i,n,a,c,_,u,p;let g;if(s&&(null===(i=null===(l=this._loggerManager)||void 0===l?void 0:l.info)||void 0===i||i.call(l,o.MESSAGES.PROCESSING_ENTITY.replace("#",s))),Object.prototype.hasOwnProperty.call(t,"OR")&&e.arrayNotEmpty(null==t?void 0:t.OR)){for(let e=0,s=t.OR.length;e<s;e++)if(g=this._processAND(r,t.OR[e]),Object.values(o.RuleError).includes(g)?null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.info)||void 0===a||a.call(n,o.ERROR_MESSAGES.RULE_ERROR):null===(_=null===(c=this._loggerManager)||void 0===c?void 0:c.info)||void 0===_||_.call(c,!1===g?o.MESSAGES.RULE_NOT_MATCH:o.MESSAGES.RULE_MATCH.replace("#",String(e))),!1!==g)return g}else null===(p=null===(u=this._loggerManager)||void 0===u?void 0:u.warn)||void 0===p||p.call(u,o.ERROR_MESSAGES.RULE_NOT_VALID);return!1}isValidRule(e){return Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")}_processAND(r,t){var s,l,i,n;let a;if(Object.prototype.hasOwnProperty.call(t,"AND")&&e.arrayNotEmpty(null==t?void 0:t.AND)){for(let e=0,o=t.AND.length;e<o;e++)if(a=this._processORWHEN(r,t.AND[e]),!1===a)return!1;return!1!==a&&(null===(l=null===(s=this._loggerManager)||void 0===s?void 0:s.info)||void 0===l||l.call(s,o.MESSAGES.RULE_MATCH_AND)),a}return null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===n||n.call(i,o.ERROR_MESSAGES.RULE_NOT_VALID),!1}_processORWHEN(r,t){var s,l;let i;if(Object.prototype.hasOwnProperty.call(t,"OR_WHEN")&&e.arrayNotEmpty(null==t?void 0:t.OR_WHEN)){for(let e=0,o=t.OR_WHEN.length;e<o;e++)if(i=this._processRuleItem(r,t.OR_WHEN[e]),!1!==i)return i}else null===(l=null===(s=this._loggerManager)||void 0===s?void 0:s.warn)||void 0===l||l.call(s,o.ERROR_MESSAGES.RULE_NOT_VALID);return!1}_processRuleItem(r,t){var s,l,i,n,a,c,_,u;if(this.isValidRule(t))try{const a=t.matching.negated||!1,c=t.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(c))if("object"==typeof r){if(r.constructor===Object)for(const e of Object.keys(r)){const o=this._keys_case_sensitive?e:e.toLowerCase();if(o===(this._keys_case_sensitive?t.key:t.key.toLowerCase()))return this._comparisonProcessor[c](r[e],t.value,a)}else if(null==t?void 0:t.rule_type){null===(l=null===(s=this._loggerManager)||void 0===s?void 0:s.info)||void 0===l||l.call(s,o.MESSAGES.RULE_MATCH_START.replace("#",t.rule_type));for(const s of Object.getOwnPropertyNames(r.constructor.prototype)){if("constructor"===s)continue;if(s===e.camelCase(`get ${t.rule_type.replace(/_/g," ")}`)){const e=r[s](t);return Object.values(o.RuleError).includes(e)||"js_condition"===t.rule_type?e:this._comparisonProcessor[c](e,t.value,a)}}}}else null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===n||n.call(i,"RuleManager._processRule()",{warn:o.ERROR_MESSAGES.RULE_DATA_NOT_VALID})}catch(e){null===(c=null===(a=this._loggerManager)||void 0===a?void 0:a.error)||void 0===c||c.call(a,"RuleManager._processRule()",{error:e.message})}else null===(u=null===(_=this._loggerManager)||void 0===_?void 0:_.warn)||void 0===u||u.call(_,o.ERROR_MESSAGES.RULE_NOT_VALID);return!1}};
//# sourceMappingURL=index.min.js.map
