/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
import{Comparisons as e,objectDeepValue as o,arrayNotEmpty as r,camelCase as t}from"@convertcom/js-sdk-utils";import{MESSAGES as s,RuleError as l,ERROR_MESSAGES as i}from"@convertcom/js-sdk-enums";class n{constructor(r,{loggerManager:t}={}){this._comparisonProcessor=e,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=t,this._comparisonProcessor=o(r,"rules.comparisonProcessor",e),this._negation=String(o(r,"rules.negation","!")).valueOf(),this._keys_case_sensitive=o(r,"rules.keys_case_sensitive",true,!0)}set comparisonProcessor(e){this._comparisonProcessor=e}get comparisonProcessor(){return this._comparisonProcessor}getComparisonProcessorMethods(){return Object.getOwnPropertyNames(this._comparisonProcessor).filter((e=>"function"==typeof this._comparisonProcessor[e]))}isRuleMatched(e,o,t){var n,a,c,_,u,g,p,h;let v;if(t&&(null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.info)||void 0===a||a.call(n,s.PROCESSING_ENTITY.replace("#",t))),Object.prototype.hasOwnProperty.call(o,"OR")&&r(null==o?void 0:o.OR)){for(let r=0,t=o.OR.length;r<t;r++)if(v=this._processAND(e,o.OR[r]),Object.values(l).includes(v)?null===(_=null===(c=this._loggerManager)||void 0===c?void 0:c.info)||void 0===_||_.call(c,i.RULE_ERROR):null===(g=null===(u=this._loggerManager)||void 0===u?void 0:u.info)||void 0===g||g.call(u,!1===v?s.RULE_NOT_MATCH:s.RULE_MATCH.replace("#",String(r))),!1!==v)return v}else null===(h=null===(p=this._loggerManager)||void 0===p?void 0:p.warn)||void 0===h||h.call(p,i.RULE_NOT_VALID);return!1}isValidRule(e){return Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")}_processAND(e,o){var t,l,n,a;let c;if(Object.prototype.hasOwnProperty.call(o,"AND")&&r(null==o?void 0:o.AND)){for(let r=0,t=o.AND.length;r<t;r++)if(c=this._processORWHEN(e,o.AND[r]),!1===c)return!1;return!1!==c&&(null===(l=null===(t=this._loggerManager)||void 0===t?void 0:t.info)||void 0===l||l.call(t,s.RULE_MATCH_AND)),c}return null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.warn)||void 0===a||a.call(n,i.RULE_NOT_VALID),!1}_processORWHEN(e,o){var t,s;let l;if(Object.prototype.hasOwnProperty.call(o,"OR_WHEN")&&r(null==o?void 0:o.OR_WHEN)){for(let r=0,t=o.OR_WHEN.length;r<t;r++)if(l=this._processRuleItem(e,o.OR_WHEN[r]),!1!==l)return l}else null===(s=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===s||s.call(t,i.RULE_NOT_VALID);return!1}_processRuleItem(e,o){var r,n,a,c,_,u,g,p;if(this.isValidRule(o))try{const _=o.matching.negated||!1,u=o.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(u))if("object"==typeof e){if(e.constructor===Object)for(const r of Object.keys(e)){const t=this._keys_case_sensitive?r:r.toLowerCase();if(t===(this._keys_case_sensitive?o.key:o.key.toLowerCase()))return this._comparisonProcessor[u](e[r],o.value,_)}else if(null==o?void 0:o.rule_type){null===(n=null===(r=this._loggerManager)||void 0===r?void 0:r.info)||void 0===n||n.call(r,s.RULE_MATCH_START.replace("#",o.rule_type));for(const r of Object.getOwnPropertyNames(e.constructor.prototype)){if("constructor"===r)continue;if(r===t(`get ${o.rule_type.replace(/_/g," ")}`)){const t=e[r](o);return Object.values(l).includes(t)||"js_condition"===o.rule_type?t:this._comparisonProcessor[u](t,o.value,_)}}}}else null===(c=null===(a=this._loggerManager)||void 0===a?void 0:a.warn)||void 0===c||c.call(a,"RuleManager._processRule()",{warn:i.RULE_DATA_NOT_VALID})}catch(e){null===(u=null===(_=this._loggerManager)||void 0===_?void 0:_.error)||void 0===u||u.call(_,"RuleManager._processRule()",{error:e.message})}else null===(p=null===(g=this._loggerManager)||void 0===g?void 0:g.warn)||void 0===p||p.call(g,i.RULE_NOT_VALID);return!1}}export{n as RuleManager};
//# sourceMappingURL=index.min.mjs.map
