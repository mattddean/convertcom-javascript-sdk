/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
import{Comparisons as e,objectDeepValue as o,arrayNotEmpty as r,camelCase as t}from"@convertcom/js-sdk-utils";import{RuleError as s,ERROR_MESSAGES as i,MESSAGES as l}from"@convertcom/js-sdk-enums";class n{constructor(r,{loggerManager:t}={}){this._comparisonProcessor=e,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=t,this._comparisonProcessor=o(r,"rules.comparisonProcessor",e),this._negation=String(o(r,"rules.negation","!")).valueOf(),this._keys_case_sensitive=o(r,"rules.keys_case_sensitive",true,!0)}set comparisonProcessor(e){this._comparisonProcessor=e}get comparisonProcessor(){return this._comparisonProcessor}getComparisonProcessorMethods(){return Object.getOwnPropertyNames(this._comparisonProcessor).filter((e=>"function"==typeof this._comparisonProcessor[e]))}isRuleMatched(e,o){var t,n,a,c,_,u;let p;if(Object.prototype.hasOwnProperty.call(o,"OR")&&r(null==o?void 0:o.OR)){for(let r=0,_=o.OR.length;r<_;r++)if(p=this._processAND(e,o.OR[r]),Object.values(s).includes(p)?null===(n=null===(t=this._loggerManager)||void 0===t?void 0:t.info)||void 0===n||n.call(t,i.RULE_ERROR,p):null===(c=null===(a=this._loggerManager)||void 0===a?void 0:a.info)||void 0===c||c.call(a,!1===p?l.RULES_NOT_MATCH:l.RULES_MATCH),!1!==p)return p}else null===(u=null===(_=this._loggerManager)||void 0===_?void 0:_.warn)||void 0===u||u.call(_,i.RULE_NOT_VALID);return!1}isValidRule(e){return Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")}_processAND(e,o){var t,s;let l;if(Object.prototype.hasOwnProperty.call(o,"AND")&&r(null==o?void 0:o.AND)){for(let r=0,t=o.AND.length;r<t;r++)if(l=this._processORWHEN(e,o.AND[r]),!1===l)return!1;return l}return null===(s=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===s||s.call(t,i.RULE_NOT_VALID),!1}_processORWHEN(e,o){var t,s;let l;if(Object.prototype.hasOwnProperty.call(o,"OR_WHEN")&&r(null==o?void 0:o.OR_WHEN)){for(let r=0,t=o.OR_WHEN.length;r<t;r++)if(l=this._processRuleItem(e,o.OR_WHEN[r]),!1!==l)return l}else null===(s=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===s||s.call(t,i.RULE_NOT_VALID);return!1}_processRuleItem(e,o){var r,l,n,a,c,_;if(this.isValidRule(o))try{const n=o.matching.negated||!1,a=o.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(a))if("object"==typeof e){if(e.constructor===Object)for(const r of Object.keys(e)){const t=this._keys_case_sensitive?r:r.toLowerCase();if(t===(this._keys_case_sensitive?o.key:o.key.toLowerCase()))return this._comparisonProcessor[a](e[r],o.value,n)}else if(null==o?void 0:o.rule_type)for(const r of Object.getOwnPropertyNames(e.constructor.prototype)){if("constructor"===r)continue;if(r===t(`get ${o.rule_type.replace(/_/g," ")}`)){const t=e[r](o);return Object.values(s).includes(t)||"js_condition"===o.rule_type?t:this._comparisonProcessor[a](t,o.value,n)}}}else null===(l=null===(r=this._loggerManager)||void 0===r?void 0:r.warn)||void 0===l||l.call(r,"RuleManager._processRule()",{warn:i.RULE_DATA_NOT_VALID})}catch(e){null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.error)||void 0===a||a.call(n,"RuleManager._processRule()",{error:e.message})}else null===(_=null===(c=this._loggerManager)||void 0===c?void 0:c.warn)||void 0===_||_.call(c,i.RULE_NOT_VALID);return!1}}export{n as RuleManager};
//# sourceMappingURL=index.min.mjs.map
