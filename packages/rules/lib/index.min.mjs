/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
import{Comparisons as e,objectDeepValue as o,camelCase as r,arrayNotEmpty as t}from"@convertcom/js-sdk-utils";import{MESSAGES as l,RuleError as s,ERROR_MESSAGES as i}from"@convertcom/js-sdk-enums";class n{constructor(r,{loggerManager:t}={}){this._comparisonProcessor=e,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=t,this._comparisonProcessor=o(r,"rules.comparisonProcessor",e),this._negation=String(o(r,"rules.negation","!")).valueOf(),this._keys_case_sensitive=o(r,"rules.keys_case_sensitive",true,!0)}set comparisonProcessor(e){this._comparisonProcessor=e}get comparisonProcessor(){return this._comparisonProcessor}getComparisonProcessorMethods(){return Object.getOwnPropertyNames(this._comparisonProcessor).filter((e=>"function"==typeof this._comparisonProcessor[e]))}isRuleMatched(e,o,n,a="id"){var c,_,u,g,p,v,d,h,O,f;let y;if(n&&((null==e?void 0:e[a])?null===(_=null===(c=this._loggerManager)||void 0===c?void 0:c.info)||void 0===_||_.call(c,l.PROCESSING_ENTITY.replace("#",`${r(n)} #${null==e?void 0:e[a]}`)):null===(g=null===(u=this._loggerManager)||void 0===u?void 0:u.info)||void 0===g||g.call(u,l.PROCESSING_ENTITY.replace("#",r(n)))),Object.prototype.hasOwnProperty.call(o,"OR")&&t(null==o?void 0:o.OR)){for(let r=0,t=o.OR.length;r<t;r++)if(y=this._processAND(e,o.OR[r]),Object.values(s).includes(y)?null===(v=null===(p=this._loggerManager)||void 0===p?void 0:p.info)||void 0===v||v.call(p,i.RULE_ERROR):null===(h=null===(d=this._loggerManager)||void 0===d?void 0:d.info)||void 0===h||h.call(d,!1===y?l.RULE_NOT_MATCH:l.RULE_MATCH.replace("#",String(r))),!1!==y)return y}else null===(f=null===(O=this._loggerManager)||void 0===O?void 0:O.warn)||void 0===f||f.call(O,i.RULE_NOT_VALID);return!1}isValidRule(e){return Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")}_processAND(e,o){var r,s,n,a;let c;if(Object.prototype.hasOwnProperty.call(o,"AND")&&t(null==o?void 0:o.AND)){for(let r=0,t=o.AND.length;r<t;r++)if(c=this._processORWHEN(e,o.AND[r]),!1===c)return!1;return!1!==c&&(null===(s=null===(r=this._loggerManager)||void 0===r?void 0:r.info)||void 0===s||s.call(r,l.RULE_MATCH_AND)),c}return null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.warn)||void 0===a||a.call(n,i.RULE_NOT_VALID),!1}_processORWHEN(e,o){var r,l;let s;if(Object.prototype.hasOwnProperty.call(o,"OR_WHEN")&&t(null==o?void 0:o.OR_WHEN)){for(let r=0,t=o.OR_WHEN.length;r<t;r++)if(s=this._processRuleItem(e,o.OR_WHEN[r]),!1!==s)return s}else null===(l=null===(r=this._loggerManager)||void 0===r?void 0:r.warn)||void 0===l||l.call(r,i.RULE_NOT_VALID);return!1}_processRuleItem(e,o){var t,n,a,c,_,u,g,p;if(this.isValidRule(o))try{const _=o.matching.negated||!1,u=o.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(u))if("object"==typeof e){if(e.constructor===Object)for(const r of Object.keys(e)){const t=this._keys_case_sensitive?r:r.toLowerCase();if(t===(this._keys_case_sensitive?o.key:o.key.toLowerCase()))return this._comparisonProcessor[u](e[r],o.value,_)}else if(null==o?void 0:o.rule_type){null===(n=null===(t=this._loggerManager)||void 0===t?void 0:t.info)||void 0===n||n.call(t,l.RULE_MATCH_START.replace("#",o.rule_type));for(const t of Object.getOwnPropertyNames(e.constructor.prototype)){if("constructor"===t)continue;if(t===r(`get ${o.rule_type.replace(/_/g," ")}`)){const r=e[t](o);return Object.values(s).includes(r)||"js_condition"===o.rule_type?r:this._comparisonProcessor[u](r,o.value,_)}}}}else null===(c=null===(a=this._loggerManager)||void 0===a?void 0:a.warn)||void 0===c||c.call(a,"RuleManager._processRule()",{warn:i.RULE_DATA_NOT_VALID})}catch(e){null===(u=null===(_=this._loggerManager)||void 0===_?void 0:_.error)||void 0===u||u.call(_,"RuleManager._processRule()",{error:e.message})}else null===(p=null===(g=this._loggerManager)||void 0===g?void 0:g.warn)||void 0===p||p.call(g,i.RULE_NOT_VALID);return!1}}export{n as RuleManager};
//# sourceMappingURL=index.min.mjs.map
