/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
import{Comparisons as e,objectDeepValue as o,arrayNotEmpty as r,camelCase as t}from"@convertcom/js-sdk-utils";import{ERROR_MESSAGES as s,RuleError as n}from"@convertcom/js-sdk-enums";class i{constructor(r,{loggerManager:t}={}){this._comparisonProcessor=e,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=t,this._comparisonProcessor=o(r,"rules.comparisonProcessor",e),this._negation=String(o(r,"rules.negation","!")).valueOf(),this._keys_case_sensitive=o(r,"rules.keys_case_sensitive",true,!0)}set comparisonProcessor(e){this._comparisonProcessor=e}get comparisonProcessor(){return this._comparisonProcessor}getComparisonProcessorMethods(){return Object.getOwnPropertyNames(this._comparisonProcessor).filter((e=>"function"==typeof this._comparisonProcessor[e]))}isRuleMatched(e,o){var t,n;let i;if(Object.prototype.hasOwnProperty.call(o,"OR")&&r(null==o?void 0:o.OR)){for(let r=0,t=o.OR.length;r<t;r++)if(i=this._processAND(e,o.OR[r]),!1!==i)return i}else null===(n=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===n||n.call(t,s.RULE_NOT_VALID);return!1}isValidRule(e){return Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")}_processAND(e,o){var t,n;let i;if(Object.prototype.hasOwnProperty.call(o,"AND")&&r(null==o?void 0:o.AND)){for(let r=0,t=o.AND.length;r<t;r++)if(i=this._processORWHEN(e,o.AND[r]),!1===i)return!1;return i}return null===(n=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===n||n.call(t,s.RULE_NOT_VALID),!1}_processORWHEN(e,o){var t,n;let i;if(Object.prototype.hasOwnProperty.call(o,"OR_WHEN")&&r(null==o?void 0:o.OR_WHEN)){for(let r=0,t=o.OR_WHEN.length;r<t;r++)if(i=this._processRuleItem(e,o.OR_WHEN[r]),!1!==i)return i}else null===(n=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===n||n.call(t,s.RULE_NOT_VALID);return!1}_processRuleItem(e,o){var r,i,l,a,c,_;if(this.isValidRule(o))try{const l=o.matching.negated||!1,a=o.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(a))if("object"==typeof e){if(e.constructor===Object)for(const r of Object.keys(e)){const t=this._keys_case_sensitive?r:r.toLowerCase();if(t===(this._keys_case_sensitive?o.key:o.key.toLowerCase()))return this._comparisonProcessor[a](e[r],o.value,l)}else if(null==o?void 0:o.rule_type)for(const r of Object.getOwnPropertyNames(e.constructor.prototype)){if("constructor"===r)continue;if(r===t(`get ${o.rule_type.replace(/_/g," ")}`)){const t=e[r](o);return Object.values(n).includes(t)||"js_condition"===o.rule_type?t:this._comparisonProcessor[a](t,o.value,l)}}}else null===(i=null===(r=this._loggerManager)||void 0===r?void 0:r.warn)||void 0===i||i.call(r,"RuleManager._processRule()",{warn:s.RULE_DATA_NOT_VALID})}catch(e){null===(a=null===(l=this._loggerManager)||void 0===l?void 0:l.error)||void 0===a||a.call(l,"RuleManager._processRule()",{error:e.message})}else null===(_=null===(c=this._loggerManager)||void 0===c?void 0:c.warn)||void 0===_||_.call(c,s.RULE_NOT_VALID);return!1}}export{i as RuleManager};
//# sourceMappingURL=index.min.mjs.map
