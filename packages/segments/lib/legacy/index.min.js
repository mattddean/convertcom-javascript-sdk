/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/js-sdk-enums"),t=require("@convertcom/js-sdk-utils"),r=function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)};function n(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return s}function a(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var o=function(){function o(e,r){var n=r.dataManager,a=r.ruleManager,o=r.loggerManager;this._dataManager=n,this._ruleManager=a,this._loggerManager=o,this._data=t.objectDeepValue(e,"data")}return o.prototype.getSegments=function(e){var t=this._dataManager.getLocalStore(e)||{};return null==t?void 0:t.segments},o.prototype.putSegments=function(e,t){var n=this._dataManager.getLocalStore(e)||{};this._dataManager.putLocalStore(e,r(r({},n),{segments:t}));var a=this._dataManager.getStoreKey(e);this._dataManager.dataStoreManager.enqueue(a,r(r({},n),{segments:t}))},o.prototype.setCustomSegments=function(t,o,s){var i,u,l,g,c,d=this._dataManager.getLocalStore(t)||{},f=d.segments,p=(void 0===f?{}:f)[e.SegmentsKeys.CUSTOM_SEGMENTS],y=void 0===p?[]:p,v=[],h=!1;try{for(var m=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),S=m.next();!S.done;S=m.next()){var M=S.value;if(s&&!h&&(h=this._ruleManager.isRuleMatched(s,null==M?void 0:M.rules),Object.values(e.RuleError).includes(h)))return h;if(!s||h){var _=null===(g=null==M?void 0:M.id)||void 0===g?void 0:g.toString();y.includes(_)||v.push(_)}}}catch(e){i={error:e}}finally{try{S&&!S.done&&(u=m.return)&&u.call(m)}finally{if(i)throw i.error}}return v.length&&(c=r(r({},d.segments||{}),((l={})[e.SegmentsKeys.CUSTOM_SEGMENTS]=a(a([],n(y),!1),n(v),!1),l)),this.putSegments(t,c)),c},o.prototype.selectCustomSegments=function(e,t,r){var n=this._dataManager.getEntities(t,"segments");return this.setCustomSegments(e,n,r)},o.prototype.selectCustomSegmentsByIds=function(e,t,r){var n=this._dataManager.getEntitiesByIds(t,"segments");return this.setCustomSegments(e,n,r)},o}();exports.SegmentsManager=o;
//# sourceMappingURL=index.min.js.map
