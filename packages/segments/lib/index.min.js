/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/js-sdk-enums"),t=require("@convertcom/js-sdk-utils");exports.SegmentsManager=class{constructor(e,{dataManager:s,ruleManager:a,loggerManager:n}){this._dataManager=s,this._ruleManager=a,this._loggerManager=n,this._data=t.objectDeepValue(e,"data")}getSegments(e){const t=this._dataManager.getLocalStore(e)||{};return null==t?void 0:t.segments}putSegments(e,t){const s=this._dataManager.getLocalStore(e)||{};this._dataManager.putLocalStore(e,Object.assign(Object.assign({},s),{segments:t}));const a=this._dataManager.getStoreKey(e);this._dataManager.dataStoreManager.enqueue(a,Object.assign(Object.assign({},s),{segments:t}))}setCustomSegments(t,s,a){var n,r,g,i,o;const l=this._dataManager.getLocalStore(t)||{},{segments:{[e.SegmentsKeys.CUSTOM_SEGMENTS]:u=[]}={}}=l,c=[];let S,d=!1;for(const t of s){if(a&&!d&&(d=this._ruleManager.isRuleMatched(a,null==t?void 0:t.rules),Object.values(e.RuleError).includes(d)))return d;if(!a||d){const s=null===(n=null==t?void 0:t.id)||void 0===n?void 0:n.toString();u.includes(s)?null===(g=null===(r=this._loggerManager)||void 0===r?void 0:r.warn)||void 0===g||g.call(r,e.MESSAGES.CUSTOM_SEGMENTS_KEY_FOUND):c.push(s)}}return c.length?(S=Object.assign(Object.assign({},l.segments||{}),{[e.SegmentsKeys.CUSTOM_SEGMENTS]:[...u,...c]}),this.putSegments(t,S)):null===(o=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===o||o.call(i,e.MESSAGES.SEGMENTS_NOT_FOUND),S}selectCustomSegments(e,t,s){const a=this._dataManager.getEntities(t,"segments");return this.setCustomSegments(e,a,s)}selectCustomSegmentsByIds(e,t,s){const a=this._dataManager.getEntitiesByIds(t,"segments");return this.setCustomSegments(e,a,s)}};
//# sourceMappingURL=index.min.js.map
