/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
import{SegmentsKeys as t,RuleError as e,MESSAGES as s}from"@convertcom/js-sdk-enums";import{objectDeepValue as a}from"@convertcom/js-sdk-utils";class n{constructor(t,{dataManager:e,ruleManager:s,loggerManager:n}){this._dataManager=e,this._ruleManager=s,this._loggerManager=n,this._data=a(t,"data")}getSegments(t){const e=this._dataManager.getLocalStore(t)||{};return null==e?void 0:e.segments}putSegments(t,e){const s=this._dataManager.getLocalStore(t)||{};this._dataManager.putLocalStore(t,Object.assign(Object.assign({},s),{segments:e}));const a=this._dataManager.getStoreKey(t);this._dataManager.dataStoreManager.enqueue(a,Object.assign(Object.assign({},s),{segments:e}))}setCustomSegments(a,n,g){var r,o,i,l,u;const d=this._dataManager.getLocalStore(a)||{},{segments:{[t.CUSTOM_SEGMENTS]:c=[]}={}}=d,m=[];let S,M=!1;for(const t of n){if(g&&!M&&(M=this._ruleManager.isRuleMatched(g,null==t?void 0:t.rules,`Segments #${null==t?void 0:t.id}`),Object.values(e).includes(M)))return M;if(!g||M){const e=null===(r=null==t?void 0:t.id)||void 0===r?void 0:r.toString();c.includes(e)?null===(i=null===(o=this._loggerManager)||void 0===o?void 0:o.warn)||void 0===i||i.call(o,s.CUSTOM_SEGMENTS_KEY_FOUND):m.push(e)}}return m.length?(S=Object.assign(Object.assign({},d.segments||{}),{[t.CUSTOM_SEGMENTS]:[...c,...m]}),this.putSegments(a,S)):null===(u=null===(l=this._loggerManager)||void 0===l?void 0:l.warn)||void 0===u||u.call(l,s.SEGMENTS_NOT_FOUND),S}selectCustomSegments(t,e,s){const a=this._dataManager.getEntities(e,"segments");return this.setCustomSegments(t,a,s)}selectCustomSegmentsByIds(t,e,s){const a=this._dataManager.getEntitiesByIds(e,"segments");return this.setCustomSegments(t,a,s)}}export{n as SegmentsManager};
//# sourceMappingURL=index.min.mjs.map
